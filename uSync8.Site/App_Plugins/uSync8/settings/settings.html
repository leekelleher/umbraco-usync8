<div ng-controller="uSyncSettingsController as vm">
    <div class="usync-settings">
        <div class="usync-main-settings">
            <umb-box>
                <umb-box-header title="Settings" description="Controls what uSync does and when">
                    <umb-button type="button"
                                button-style="success"
                                label-key="usync_savesettings"
                                action="vm.saveSettings()"
                                disabled="vm.working">
                </umb-box-header>
                <umb-box-content>

                    <div class="umb-permission">
                        <umb-toggle class="umb-permission__toggle"
                                    checked="vm.settings.ImportAtStartup"
                                    on-click="vm.settings.ImportAtStartup = !vm.settings.ImportAtStartup">
                        </umb-toggle>
                        <div class="umb-permission__content" ng-click="vm.settings.ImportAtStartup = !vm.settings.ImportAtStartup">
                            <div>Import at startup</div>
                            <div class="umb-permission__description">Run an import of files from the disk when Umbraco starts</div>
                        </div>
                    </div>

                    <div class="umb-permission">
                        <umb-toggle class="umb-permission__toggle"
                                    checked="vm.settings.ExportAtStartup"
                                    on-click="vm.settings.ExportAtStartup = !vm.settings.ExportAtStartup">
                        </umb-toggle>
                        <div class="umb-permission__content" ng-click="vm.settings.ExportAtStartup = !vm.settings.ExportAtStartup">
                            <div>Export at startup</div>
                            <div class="umb-permission__description">Export the Umbraco settings when the site starts up</div>
                        </div>
                    </div>


                    <div class="umb-permission">
                        <umb-toggle class="umb-permission__toggle"
                                    checked="vm.settings.ExportOnSave"
                                    on-click="vm.settings.ExportOnSave = !vm.settings.ExportOnSave">
                        </umb-toggle>
                        <div class="umb-permission__content" ng-click="vm.settings.ExportOnSave= !vm.settings.ExportOnSave">
                            <div>Export on Save</div>
                            <div class="umb-permission__description">Generate uSync files when items are saved</div>
                        </div>
                    </div>

                    <div class="umb-permission" ng-if="vm.umbracoVersion < '8.4.0'">
                        <umb-toggle class="umb-permission__toggle"
                                    checked="vm.settings.RebuildCacheOnCompletion"
                                    on-click="vm.settings.RebuildCacheOnCompletion = !vm.settings.RebuildCacheOnCompletion">
                        </umb-toggle>
                        <div class="umb-permission__content" ng-click="vm.settings.RebuildCacheOnCompletion = !vm.settings.RebuildCacheOnCompletion">
                            <div>Rebuild Cache after import</div>
                            <div class="umb-permission__description">Request that Umbraco rebuilds its cache after an import</div>
                        </div>
                    </div>

                    <div class="umb-permission">
                        <umb-toggle class="umb-permission__toggle"
                                    checked="vm.settings.FailOnMissingParent"
                                    on-click="vm.toggleSetting('FailOnMissingParent')">
                        </umb-toggle>
                        <div class="umb-permission__content" ng-click="vm.toggleSetting('FailOnMissingParent')">
                            <div>Fail on Missing Parent</div>
                            <div class="umb-permission__description">Import of an item will fail if it's parent is not already in Umbraco or the current Import</div>
                        </div>
                    </div>

                    <div class="umb-permission">
                        <umb-toggle class="umb-permission__toggle"
                                    checked="vm.settings.CreateOnly"
                                    on-click="vm.toggleSetting('CreateOnly')">
                        </umb-toggle>
                        <div class="umb-permission__content" ng-click="vm.toggleSetting('CreateOnly')">
                            <div>Create Only</div>
                            <div class="umb-permission__description">Only import new items that don't already exist on this site</div>
                        </div>
                    </div>

                </umb-box-content>
            </umb-box>

            <umb-box>
                <umb-box-header title="Files and Folders"
                                description="Control how uSync writes and reads files to disk"></umb-box-header>
                <umb-box-content>
                    <div>
                        <p class="color-deep-orange">
                            <em>If you change these settings, you should perform a 'Clean Export' as they alter the structure of the uSync folders</em>
                        </p>
                    </div>
                    <div class="umb-permission">
                        <umb-toggle class="umb-permission__toggle"
                                    checked="vm.settings.UseFlatStructure"
                                    on-click="vm.toggleSetting('UseFlatStructure')">
                        </umb-toggle>
                        <div class="umb-permission__content" ng-click="vm.toggleSetting('UseFlatStructure')">
                            <div>Flat structure</div>
                            <div class="umb-permission__description">All items of a type are stored in a flat folder strucure</div>
                        </div>
                    </div>
                    <div class="umb-permission">
                        <umb-toggle class="umb-permission__toggle"
                                    checked="vm.settings.UseGuidNames"
                                    on-click="vm.toggleSetting('UseGuidNames', 'GuidNames')">
                        </umb-toggle>
                        <div class="umb-permission__content" ng-click="vm.toggleSetting('UseGuidNames', 'GuidNames')">
                            <div>Use Guids for filenames</div>
                            <div class="umb-permission__description">Use the guid of an item as the filename</div>
                        </div>
                    </div>

                    <div class="umb-el-wrap usync-root-folder">
                        <label for="rootFolder" class="control-label">Root Folder</label>
                        <div class="controls">
                            <div class="db">
                                <input type="text" class="umb-textstring" id="rootFolder" ng-model="vm.settings.RootFolder" />
                            </div>
                        </div>
                    </div>
                </umb-box-content>
            </umb-box>
        </div>
        <div>
            <umb-box>
                <umb-box-header title="Handlers" description="Controllers for each type of object"></umb-box-header>
                <umb-box-content>Default Set : <strong>{{vm.settings.DefaultSet}}</strong></umb-box-content>
            </umb-box>
            <umb-box ng-repeat="handlerSet in vm.settings.HandlerSets" class="usync-handler-box">
                <umb-box-header title="Handler Set: {{handlerSet.Name}}" ng-click="handlerSet.show = !handlerSet.show"></umb-box-header>
                <umb-box-content ng-if="handlerSet.show">
                    <div ng-repeat="handler in handlerSet.Handlers"
                         class="flex justify-between usync-handler-list">
                        <div class="umb-permission">
                            <umb-toggle class="umb-permission__toggle"
                                        checked="handler.Enabled"
                                        on-click="handler.Enabled = !handler.Enabled">
                            </umb-toggle>

                            <div class="umb-permission__content">
                                <div class="permission-name">
                                    {{handler.Alias}}
                                </div>
                                <div class="umb-permission__description">
                                    Enabled for :
                                    <span ng-repeat="action in handler.Actions">{{action}}</span>

                                    <div ng-if="handler.CreateOnly.IsOverridden">Create Only : {{handler.CreateOnly.Value}}</div>
                                    <div ng-if="handler.FailOnMissingParent.IsOverridden">Fail on missing parent: {{handler.FailOnMissingParent.Value}}</div>
                                    <div ng-if="handler.GuidNames.IsOverridden">Use Guid Names : {{handler.GuidNames.Value}}</div>
                                    <div ng-if="handler.UseFlatStructure.IsOverridden">Flat Structure: {{handler.UseFlatStructure.Value}}</div>
                                </div>
                            </div>
                        </div>
                        <umb-button action="vm.openHandlerConfig(handler)"
                                    type="button"
                                    button-style="link"
                                    label="Settings"></umb-button>
                    </div>
                </umb-box-content>
            </umb-box>
        </div>
    </div>
</div>
